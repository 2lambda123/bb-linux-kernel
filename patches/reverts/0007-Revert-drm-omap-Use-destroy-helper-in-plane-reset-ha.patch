From 49d27ab2fe8cdffd50d54c3666296f7d975105b6 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Mon, 24 Aug 2015 14:23:25 -0500
Subject: [PATCH 07/10] Revert "drm/omap: Use destroy helper in plane reset
 handler"

This reverts commit e457fc027abc7ab85943e6a258fea35b756a515e.

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 drivers/gpu/drm/omapdrm/omap_plane.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/drivers/gpu/drm/omapdrm/omap_plane.c b/drivers/gpu/drm/omapdrm/omap_plane.c
index 6a95dbf..ec29b1c 100644
--- a/drivers/gpu/drm/omapdrm/omap_plane.c
+++ b/drivers/gpu/drm/omapdrm/omap_plane.c
@@ -194,12 +194,11 @@ static void omap_plane_reset(struct drm_plane *plane)
 	struct omap_plane *omap_plane = to_omap_plane(plane);
 	struct omap_plane_state *omap_state;
 
-	if (plane->state) {
-		__drm_atomic_helper_plane_destroy_state(plane, plane->state);
+	if (plane->state && plane->state->fb)
+		drm_framebuffer_unreference(plane->state->fb);
 
-		kfree(plane->state);
-		plane->state = NULL;
-	}
+	kfree(plane->state);
+	plane->state = NULL;
 
 	omap_state = kzalloc(sizeof(*omap_state), GFP_KERNEL);
 	if (omap_state == NULL)
-- 
2.5.0

