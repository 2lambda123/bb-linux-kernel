From 9020e07b6d88b5bd81bef11d71ee2604447fb623 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Wed, 10 May 2017 12:07:58 -0500
Subject: [PATCH 2/2] xenomai: drop nucleus/jhash.h

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 include/xenomai/nucleus/jhash.h      | 77 ------------------------------------
 kernel/xenomai/nucleus/shadow.c      |  1 -
 kernel/xenomai/skins/posix/syscall.c |  1 -
 kernel/xenomai/skins/vrtx/mb.c       |  1 -
 4 files changed, 80 deletions(-)
 delete mode 100644 include/xenomai/nucleus/jhash.h

diff --git a/include/xenomai/nucleus/jhash.h b/include/xenomai/nucleus/jhash.h
deleted file mode 100644
index c6f04819b79b..000000000000
--- a/include/xenomai/nucleus/jhash.h
+++ /dev/null
@@ -1,77 +0,0 @@
-/*
- * Jenkins hash support, lifted from the Linux kernel from
- * linux/include/linux/jhash.h.
- *
- * Original credits:
- *
- * Copyright (C) 1996 Bob Jenkins (bob_jenkins@burtleburtle.net)
- *
- * http://burtleburtle.net/bob/hash/
- *
- * These are the credits from Bob's sources:
- *
- * lookup2.c, by Bob Jenkins, December 1996, Public Domain.
- * hash(), hash2(), hash3, and mix() are externally useful functions.
- * Routines to test the hash are included if SELF_TEST is defined.
- * You can use this free for any purpose.  It has no warranty.
- *
- * Copyright (C) 2003 David S. Miller (davem@redhat.com)
- *
- * I've modified Bob's hash to be useful in the Linux kernel, and
- * any bugs present are surely my fault.  -DaveM
- */
-
-#ifndef _XENO_NUCLEUS_JHASH_H
-#define _XENO_NUCLEUS_JHASH_H
-
-#include <nucleus/types.h>
-
-/* NOTE: Arguments are modified. */
-#define __jhash_mix(a, b, c) \
-{ \
-  a -= b; a -= c; a ^= (c>>13); \
-  b -= c; b -= a; b ^= (a<<8); \
-  c -= a; c -= b; c ^= (b>>13); \
-  a -= b; a -= c; a ^= (c>>12);  \
-  b -= c; b -= a; b ^= (a<<16); \
-  c -= a; c -= b; c ^= (b>>5); \
-  a -= b; a -= c; a ^= (c>>3);  \
-  b -= c; b -= a; b ^= (a<<10); \
-  c -= a; c -= b; c ^= (b>>15); \
-}
-
-/* The golden ratio: an arbitrary value */
-#define JHASH_GOLDEN_RATIO	0x9e3779b9
-
-/* A special optimized version that handles 1 or more of u32s.
- * The length parameter here is the number of u32s in the key.
- */
-static inline uint32_t jhash2(const uint32_t *k, uint32_t length, uint32_t initval)
-{
-	uint32_t a, b, c, len;
-
-	a = b = JHASH_GOLDEN_RATIO;
-	c = initval;
-	len = length;
-
-	while (len >= 3) {
-		a += k[0];
-		b += k[1];
-		c += k[2];
-		__jhash_mix(a, b, c);
-		k += 3; len -= 3;
-	}
-
-	c += length * 4;
-
-	switch (len) {
-	case 2 : b += k[1];
-	case 1 : a += k[0];
-	};
-
-	__jhash_mix(a,b,c);
-
-	return c;
-}
-
-#endif /* _XENO_NUCLEUS_JHASH_H */
diff --git a/kernel/xenomai/nucleus/shadow.c b/kernel/xenomai/nucleus/shadow.c
index 6629e907da16..af7ca7a426f5 100644
--- a/kernel/xenomai/nucleus/shadow.c
+++ b/kernel/xenomai/nucleus/shadow.c
@@ -47,7 +47,6 @@
 #include <nucleus/synch.h>
 #include <nucleus/module.h>
 #include <nucleus/shadow.h>
-#include <nucleus/jhash.h>
 #include <nucleus/ppd.h>
 #include <nucleus/trace.h>
 #include <nucleus/stat.h>
diff --git a/kernel/xenomai/skins/posix/syscall.c b/kernel/xenomai/skins/posix/syscall.c
index 31e270595c68..1bd64ab26bf6 100644
--- a/kernel/xenomai/skins/posix/syscall.c
+++ b/kernel/xenomai/skins/posix/syscall.c
@@ -22,7 +22,6 @@
 
 #include <linux/err.h>
 #include <asm/xenomai/wrappers.h>
-#include <nucleus/jhash.h>
 #include <nucleus/ppd.h>
 #include <nucleus/sys_ppd.h>
 #include <posix/syscall.h>
diff --git a/kernel/xenomai/skins/vrtx/mb.c b/kernel/xenomai/skins/vrtx/mb.c
index bd6039b96127..ccd4306c38ec 100644
--- a/kernel/xenomai/skins/vrtx/mb.c
+++ b/kernel/xenomai/skins/vrtx/mb.c
@@ -18,7 +18,6 @@
  * Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  */
 
-#include <nucleus/jhash.h>
 #include <vrtx/task.h>
 #include <vrtx/mb.h>
 
-- 
2.11.0

