From 42fa608b14425d72a4de2cdafbaef197645fe65e Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Mon, 2 Nov 2015 16:07:12 -0600
Subject: [PATCH 1/5] Revert "inet: fix potential deadlock in
 reqsk_queue_unlink()"

This reverts commit d3a1196bfc462943694623412d8e03aaf172bdc1.

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 net/ipv4/inet_connection_sock.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/net/ipv4/inet_connection_sock.c b/net/ipv4/inet_connection_sock.c
index 4d2bc8c..65aca38 100644
--- a/net/ipv4/inet_connection_sock.c
+++ b/net/ipv4/inet_connection_sock.c
@@ -585,7 +585,7 @@ static bool reqsk_queue_unlink(struct request_sock_queue *queue,
 		}
 	}
 	spin_unlock(&queue->syn_wait_lock);
-	if (timer_pending(&req->rsk_timer) && del_timer_sync(&req->rsk_timer))
+	if (del_timer_sync(&req->rsk_timer))
 		reqsk_put(req);
 	return found;
 }
-- 
2.6.1

