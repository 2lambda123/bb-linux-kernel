From d6d13fdf12ff10a922b8734e38cb688dfb18cd4a Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Fri, 5 Dec 2014 09:43:11 -0600
Subject: [PATCH 24/25] cape: factor out i2c2 eeprom

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-bone-common.dtsi          | 28 --------------
 .../arm/boot/dts/am335x-bone-i2c2-cape-eeprom.dtsi | 45 ++++++++++++++++++++++
 arch/arm/boot/dts/am335x-bone.dts                  |  4 ++
 arch/arm/boot/dts/am335x-boneblack.dts             |  4 ++
 4 files changed, 53 insertions(+), 28 deletions(-)
 create mode 100644 arch/arm/boot/dts/am335x-bone-i2c2-cape-eeprom.dtsi

diff --git a/arch/arm/boot/dts/am335x-bone-common.dtsi b/arch/arm/boot/dts/am335x-bone-common.dtsi
index 00fbb94..31b95be 100644
--- a/arch/arm/boot/dts/am335x-bone-common.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-common.dtsi
@@ -126,34 +126,6 @@
 	};
 };
 
-&i2c2 {
-	status = "okay";
-	pinctrl-names = "default";
-	pinctrl-0 = <&i2c2_pins>;
-
-	clock-frequency = <100000>;
-
-	cape_eeprom0: cape_eeprom0@54 {
-		compatible = "at,24c256";
-		reg = <0x54>;
-	};
-
-	cape_eeprom1: cape_eeprom1@55 {
-		compatible = "at,24c256";
-		reg = <0x55>;
-	};
-
-	cape_eeprom2: cape_eeprom2@56 {
-		compatible = "at,24c256";
-		reg = <0x56>;
-	};
-
-	cape_eeprom3: cape_eeprom3@57 {
-		compatible = "at,24c256";
-		reg = <0x57>;
-	};
-};
-
 /include/ "tps65217.dtsi"
 
 &tps {
diff --git a/arch/arm/boot/dts/am335x-bone-i2c2-cape-eeprom.dtsi b/arch/arm/boot/dts/am335x-bone-i2c2-cape-eeprom.dtsi
new file mode 100644
index 0000000..a639b40
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-bone-i2c2-cape-eeprom.dtsi
@@ -0,0 +1,45 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+&ocp {
+	/* i2c2 */
+	P9_19_pinmux {
+		status = "i2c";
+	};
+	P9_20_pinmux {
+		status = "i2c";
+	};
+};
+
+&i2c2 {
+	status = "okay";
+	pinctrl-names = "default";
+	pinctrl-0 = <>; /* pinctrl-0 = <&i2c2_pins>; */
+
+	clock-frequency = <100000>;
+
+	cape_eeprom0: cape_eeprom0@54 {
+		compatible = "at,24c256";
+		reg = <0x54>;
+	};
+
+	cape_eeprom1: cape_eeprom1@55 {
+		compatible = "at,24c256";
+		reg = <0x55>;
+	};
+
+	cape_eeprom2: cape_eeprom2@56 {
+		compatible = "at,24c256";
+		reg = <0x56>;
+	};
+
+	cape_eeprom3: cape_eeprom3@57 {
+		compatible = "at,24c256";
+		reg = <0x57>;
+	};
+};
diff --git a/arch/arm/boot/dts/am335x-bone.dts b/arch/arm/boot/dts/am335x-bone.dts
index 93869ef..86f1e1d 100644
--- a/arch/arm/boot/dts/am335x-bone.dts
+++ b/arch/arm/boot/dts/am335x-bone.dts
@@ -49,6 +49,10 @@
 #include "am335x-can1.dtsi"
 /* #include "am335x-bone-can1.dtsi" */
 
+/* i2c2: cape eeprom */
+/* P9.19 P9.20 */
+#include "am335x-bone-i2c2-cape-eeprom.dtsi"
+
 /* spi0: */
 /* P9.17 spi0_cs0 */
 /* P9.18 spi0_d1 */
diff --git a/arch/arm/boot/dts/am335x-boneblack.dts b/arch/arm/boot/dts/am335x-boneblack.dts
index 1bced53..5614aa4 100644
--- a/arch/arm/boot/dts/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/am335x-boneblack.dts
@@ -47,6 +47,10 @@
 #include "am335x-can1.dtsi"
 /* #include "am335x-bone-can1.dtsi" */
 
+/* i2c2: cape eeprom */
+/* P9.19 P9.20 */
+#include "am335x-bone-i2c2-cape-eeprom.dtsi"
+
 /* spi0: */
 /* P9.17 spi0_cs0 */
 /* P9.18 spi0_d1 */
-- 
2.1.3

