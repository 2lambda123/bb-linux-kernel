From e7a239b1cc2e1a74d192396aefcc543c5538a643 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Thu, 18 Sep 2014 14:29:25 -0500
Subject: [PATCH 28/28] cape: bb-view-43

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-bone-bb-view-43.dtsi      | 33 +++++++++++
 arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi   | 10 ++++
 arch/arm/boot/dts/am335x-bone-keymap4.dtsi         | 67 ++++++++++++++++++++++
 .../dts/am335x-bone-panel-480x272-bgrx_16bpp.dtsi  | 59 +++++++++++++++++++
 arch/arm/boot/dts/am335x-boneblack.dts             |  4 ++
 5 files changed, 173 insertions(+)
 create mode 100644 arch/arm/boot/dts/am335x-bone-bb-view-43.dtsi
 create mode 100644 arch/arm/boot/dts/am335x-bone-keymap4.dtsi
 create mode 100644 arch/arm/boot/dts/am335x-bone-panel-480x272-bgrx_16bpp.dtsi

diff --git a/arch/arm/boot/dts/am335x-bone-bb-view-43.dtsi b/arch/arm/boot/dts/am335x-bone-bb-view-43.dtsi
new file mode 100644
index 0000000..9786816
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-bone-bb-view-43.dtsi
@@ -0,0 +1,33 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+/* Led */
+/* #include "am335x-bone-led-gpio1-18.dtsi" */
+#include "am335x-bone-led-gpio1-28.dtsi"
+/* #include "am335x-bone-led-gpio3-19.dtsi" */
+/* #include "am335x-bone-led-gpio2-4-gpio2-5.dtsi" */
+
+/* Keypad */
+/* #include "am335x-bone-keymap0.dtsi" */
+/* #include "am335x-bone-keymap1.dtsi" */
+/* #include "am335x-bone-keymap2.dtsi" */
+/* #include "am335x-bone-keymap3.dtsi" */
+#include "am335x-bone-keymap4.dtsi"
+
+/* Backlight */
+#include "am335x-bone-bl-gpio1-18.dtsi"
+
+/* Touchscreen */
+#include "am335x-bone-ti-tscadc-4-wire.dtsi"
+
+/* Panel */
+/* #include "am335x-bone-panel-320x240.dtsi" */
+/* #include "am335x-bone-panel-480x272.dtsi" */
+/* #include "am335x-bone-panel-800x480.dtsi" */
+/* #include "am335x-bone-panel-1240x600-24bit.dtsi" */
+#include "am335x-bone-panel-480x272-bgrx_16bpp.dtsi"
diff --git a/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi b/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi
index 0ff8756..80609b6 100644
--- a/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi
@@ -414,6 +414,16 @@
 		>;
 	};
 
+        /* bb-view */
+	keymap4_pins: pinmux_keymap4_pins {
+		pinctrl-single,pins = <
+			0x044 0x2f	/* usr2 gpmc_a1.gpio1_17, INPUT | PULLDIS | MODE7 */
+			0x04c 0x2f	/* usr0 gpmc_a3.gpio1_19, INPUT | PULLDIS | MODE7 */
+			0x070 0x2f	/* usr3 gpmc_wait0.gpio0_30, INPUT | PULLDIS | MODE7 */
+			0x184 0x2f	/* usr1 uart1_txd.gpio0_15, INPUT | PULLDIS | MODE7 */
+		>;
+	};
+
 	mcasp0_pins: mcasp0_pins {
 		pinctrl-single,pins = <
 			0x1ac (PIN_INPUT_PULLUP | MUX_MODE0)	/* mcasp0_ahclkx.mcasp0_ahclkx */
diff --git a/arch/arm/boot/dts/am335x-bone-keymap4.dtsi b/arch/arm/boot/dts/am335x-bone-keymap4.dtsi
new file mode 100644
index 0000000..a732de0
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-bone-keymap4.dtsi
@@ -0,0 +1,67 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+
+&ocp {
+	P9_16_pinmux {
+		status = "disabled";
+	};
+	P9_24_pinmux {
+		status = "disabled";
+	};
+	P9_23_pinmux {
+		status = "disabled";
+	};
+	P9_11_pinmux {
+		status = "disabled";
+	};
+};
+
+/ {
+	gpio_keys {
+		compatible = "gpio-keys";
+		pinctrl-names = "default";
+		pinctrl-0 = <&keymap4_pins>;
+
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		button@1 {
+			debounce_interval = <50>;
+			label = "bb-view:usr0";
+			linux,code = <0x100>;
+			gpios = <&gpio1 19 0x0>;
+			gpio-key,wakeup;
+			autorepeat;
+		};
+		button@2 {
+			debounce_interval = <50>;
+			label = "bb-view:usr1";
+			linux,code = <0x101>;
+			gpios = <&gpio0 15 0x0>;
+			gpio-key,wakeup;
+			autorepeat;
+		};
+		button@3 {
+			debounce_interval = <50>;
+			label = "bb-view:usr2";
+			linux,code = <0x102>;
+			gpios = <&gpio1 17 0x0>;
+			gpio-key,wakeup;
+			autorepeat;
+		};
+		button@4 {
+			debounce_interval = <50>;
+			label = "bb-view:usr3";
+			linux,code = <0x103>;
+			gpios = <&gpio0 30 0x0>;
+			gpio-key,wakeup;
+			autorepeat;
+		};
+	};
+};
diff --git a/arch/arm/boot/dts/am335x-bone-panel-480x272-bgrx_16bpp.dtsi b/arch/arm/boot/dts/am335x-bone-panel-480x272-bgrx_16bpp.dtsi
new file mode 100644
index 0000000..bdd05af
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-bone-panel-480x272-bgrx_16bpp.dtsi
@@ -0,0 +1,59 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+&ocp {
+	P8_37_pinmux {
+		status = "disabled";
+	};
+	P8_38_pinmux {
+		status = "disabled";
+	};
+};
+
+&lcdc {
+	bgrx_16bpp = <1>;
+	status = "okay";
+};
+
+/ {
+	panel {
+		status = "okay";
+		compatible = "ti,tilcdc,panel";
+		pinctrl-names = "default";
+		pinctrl-0 = <&bbcape_lcd_pins>;
+		panel-info {
+			ac-bias           = <255>;
+			ac-bias-intrpt    = <0>;
+			dma-burst-sz      = <16>;
+			bpp               = <16>;
+			fdd               = <0x80>;
+			sync-edge         = <0>;
+			sync-ctrl         = <1>;
+			raster-order      = <0>;
+			fifo-th           = <0>;
+		};
+		display-timings {
+			native-mode = <&timing0>;
+			timing0: 480x272 {
+				clock-frequency = <9000000>;
+				hactive = <480>;
+				vactive = <272>;
+				hfront-porch = <9>;
+				hback-porch = <44>;
+				hsync-len = <5>;
+				vback-porch = <13>;
+				vfront-porch = <4>;
+				vsync-len = <10>;
+				hsync-active = <0>;
+				vsync-active = <0>;
+				de-active = <0>;
+				pixelclk-active = <0>;
+			};
+		};
+	};
+};
diff --git a/arch/arm/boot/dts/am335x-boneblack.dts b/arch/arm/boot/dts/am335x-boneblack.dts
index 7c67d45..c376ab4 100644
--- a/arch/arm/boot/dts/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/am335x-boneblack.dts
@@ -32,6 +32,10 @@
 };
 
 &ocp {
+	/* clkout2 */
+	P9_41_pinmux {
+		status = "disabled";
+	};
 	/* mmc1 */
 	P9_92_pinmux {
 		status = "disabled";
-- 
2.1.0

