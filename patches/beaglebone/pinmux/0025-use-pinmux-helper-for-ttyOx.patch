From 7988074de0bff175bee357940484d8ee82990a7f Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Wed, 17 Sep 2014 13:55:19 -0500
Subject: [PATCH 25/25] use pinmux-helper for ttyOx

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi   | 51 ++++++++++++++++++++++
 arch/arm/boot/dts/am335x-bone-ttyO1.dtsi           | 13 ++----
 arch/arm/boot/dts/am335x-bone-ttyO2.dtsi           | 13 ++----
 arch/arm/boot/dts/am335x-bone-ttyO4.dtsi           | 13 ++----
 arch/arm/boot/dts/am335x-bone-ttyO5.dtsi           | 12 +++--
 arch/arm/boot/dts/am335x-bone.dts                  | 11 +++++
 .../boot/dts/am335x-boneblack-nxp-hdmi-audio.dtsi  |  7 +++
 arch/arm/boot/dts/am335x-boneblack.dts             |  4 ++
 arch/arm/boot/dts/am335x-ttyO1.dtsi                | 14 ++++++
 arch/arm/boot/dts/am335x-ttyO2.dtsi                | 14 ++++++
 arch/arm/boot/dts/am335x-ttyO4.dtsi                | 14 ++++++
 arch/arm/boot/dts/am335x-ttyO5.dtsi                | 14 ++++++
 12 files changed, 149 insertions(+), 31 deletions(-)
 create mode 100644 arch/arm/boot/dts/am335x-ttyO1.dtsi
 create mode 100644 arch/arm/boot/dts/am335x-ttyO2.dtsi
 create mode 100644 arch/arm/boot/dts/am335x-ttyO4.dtsi
 create mode 100644 arch/arm/boot/dts/am335x-ttyO5.dtsi

diff --git a/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi b/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi
index 4a5a3b0..0ff8756 100644
--- a/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-common-pinmux.dtsi
@@ -644,8 +644,35 @@
 	/* P8_34 (ZCZ ball U4 ) hdmi    */
 	/* P8_35 (ZCZ ball V2 ) hdmi    */
 	/* P8_36 (ZCZ ball U3 ) hdmi    */
+
 	/* P8_37 (ZCZ ball U1 ) hdmi    */
+	P8_37_default_pin: pinmux_P8_37_default_pin {
+		pinctrl-single,pins = <0x0C0  0x27>; };     /* Mode 7, Pull-Down, RxActive */
+	P8_37_gpio_pin: pinmux_P8_37_gpio_pin {
+		pinctrl-single,pins = <0x0C0  0x2F>; };     /* Mode 7, RxActive */
+	P8_37_gpio_pu_pin: pinmux_P8_37_gpio_pu_pin {
+		pinctrl-single,pins = <0x0C0  0x37>; };     /* Mode 7, Pull-Up, RxActive */
+	P8_37_gpio_pd_pin: pinmux_P8_37_gpio_pd_pin {
+		pinctrl-single,pins = <0x0C0  0x27>; };     /* Mode 7, Pull-Down, RxActive */
+	P8_37_uart_pin: pinmux_P8_37_uart_pin {
+		pinctrl-single,pins = <0x0C0  0x04>; };     /* Mode 4, Pull-Down*/
+	P8_37_pwm_pin: pinmux_P8_37_pwm_pin {
+		pinctrl-single,pins = <0x0C0  0x02>; };     /* Mode 2, Pull-Down*/
+
 	/* P8_38 (ZCZ ball U2 ) hdmi    */
+	P8_38_default_pin: pinmux_P8_38_default_pin {
+		pinctrl-single,pins = <0x0C4  0x27>; };     /* Mode 7, Pull-Down, RxActive */
+	P8_38_gpio_pin: pinmux_P8_38_gpio_pin {
+		pinctrl-single,pins = <0x0C4  0x2F>; };     /* Mode 7, RxActive */
+	P8_38_gpio_pu_pin: pinmux_P8_38_gpio_pu_pin {
+		pinctrl-single,pins = <0x0C4  0x37>; };     /* Mode 7, Pull-Up, RxActive */
+	P8_38_gpio_pd_pin: pinmux_P8_38_gpio_pd_pin {
+		pinctrl-single,pins = <0x0C4  0x27>; };     /* Mode 7, Pull-Down, RxActive */
+	P8_38_uart_pin: pinmux_P8_38_uart_pin {
+		pinctrl-single,pins = <0x0C4  0x24>; };     /* Mode 4, Pull-Down, RxActive */
+	P8_38_pwm_pin: pinmux_P8_38_pwm_pin {
+		pinctrl-single,pins = <0x0C4  0x22>; };     /* Mode 2, Pull-Down, RxActive */
+
 	/* P8_39 (ZCZ ball T3 ) hdmi    */
 	/* P8_40 (ZCZ ball T4 ) hdmi    */
 	/* P8_41 (ZCZ ball T1 ) hdmi    */
@@ -1217,6 +1244,30 @@
 		pinctrl-3 = <&P8_26_gpio_pd_pin>;
 	};
 
+	P8_37_pinmux {
+		compatible = "bone-pinmux-helper";
+		status = "okay";
+		pinctrl-names = "default", "gpio", "gpio_pu", "gpio_pd","uart","pwm";
+		pinctrl-0 = <&P8_37_default_pin>;
+		pinctrl-1 = <&P8_37_gpio_pin>;
+		pinctrl-2 = <&P8_37_gpio_pu_pin>;
+		pinctrl-3 = <&P8_37_gpio_pd_pin>;
+		pinctrl-4 = <&P8_37_uart_pin>;
+		pinctrl-5 = <&P8_37_pwm_pin>;
+	};
+
+	P8_38_pinmux {
+		compatible = "bone-pinmux-helper";
+		status = "okay";
+		pinctrl-names = "default", "gpio", "gpio_pu", "gpio_pd","uart","pwm";
+		pinctrl-0 = <&P8_38_default_pin>;
+		pinctrl-1 = <&P8_38_gpio_pin>;
+		pinctrl-2 = <&P8_38_gpio_pu_pin>;
+		pinctrl-3 = <&P8_38_gpio_pd_pin>;
+		pinctrl-4 = <&P8_38_uart_pin>;
+		pinctrl-5 = <&P8_38_pwm_pin>;
+	};
+
 	/************************/
 	/* P9 Header            */
 	/************************/
diff --git a/arch/arm/boot/dts/am335x-bone-ttyO1.dtsi b/arch/arm/boot/dts/am335x-bone-ttyO1.dtsi
index 060c93b..6bf4a0d 100644
--- a/arch/arm/boot/dts/am335x-bone-ttyO1.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-ttyO1.dtsi
@@ -6,18 +6,13 @@
  * published by the Free Software Foundation.
  */
 
+#include "am335x-ttyO1.dtsi"
+
 &ocp {
 	P9_24_pinmux {
-		status = "disabled";
+		mode = "uart";
 	};
 	P9_26_pinmux {
-		status = "disabled";
+		mode = "uart";
 	};
 };
-
-&uart1 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&uart1_pins>;
-
-	status = "okay";
-};
diff --git a/arch/arm/boot/dts/am335x-bone-ttyO2.dtsi b/arch/arm/boot/dts/am335x-bone-ttyO2.dtsi
index 849c22a..553b89e 100644
--- a/arch/arm/boot/dts/am335x-bone-ttyO2.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-ttyO2.dtsi
@@ -6,18 +6,13 @@
  * published by the Free Software Foundation.
  */
 
+#include "am335x-ttyO1.dtsi"
+
 &ocp {
 	P9_21_pinmux {
-		status = "disabled";
+		mode = "uart";
 	};
 	P9_22_pinmux {
-		status = "disabled";
+		mode = "uart";
 	};
 };
-
-&uart2 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&uart2_pins>;
-
-	status = "okay";
-};
diff --git a/arch/arm/boot/dts/am335x-bone-ttyO4.dtsi b/arch/arm/boot/dts/am335x-bone-ttyO4.dtsi
index 2348fe4..67b119c 100644
--- a/arch/arm/boot/dts/am335x-bone-ttyO4.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-ttyO4.dtsi
@@ -6,18 +6,13 @@
  * published by the Free Software Foundation.
  */
 
+#include "am335x-ttyO1.dtsi"
+
 &ocp {
 	P9_11_pinmux {
-		status = "disabled";
+		mode = "uart";
 	};
 	P9_13_pinmux {
-		status = "disabled";
+		mode = "uart";
 	};
 };
-
-&uart4 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&uart4_pins>;
-
-	status = "okay";
-};
diff --git a/arch/arm/boot/dts/am335x-bone-ttyO5.dtsi b/arch/arm/boot/dts/am335x-bone-ttyO5.dtsi
index 0b8544c..c2ee5fb 100644
--- a/arch/arm/boot/dts/am335x-bone-ttyO5.dtsi
+++ b/arch/arm/boot/dts/am335x-bone-ttyO5.dtsi
@@ -6,9 +6,13 @@
  * published by the Free Software Foundation.
  */
 
-&uart5 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&uart5_pins>;
+#include "am335x-ttyO1.dtsi"
 
-	status = "okay";
+&ocp {
+	P8_37_pinmux {
+		mode = "uart";
+	};
+	P8_38_pinmux {
+		mode = "uart";
+	};
 };
diff --git a/arch/arm/boot/dts/am335x-bone.dts b/arch/arm/boot/dts/am335x-bone.dts
index e00d052..95a6f29 100644
--- a/arch/arm/boot/dts/am335x-bone.dts
+++ b/arch/arm/boot/dts/am335x-bone.dts
@@ -22,6 +22,13 @@
 	regulator-always-on;
 };
 
+&ocp {
+	/* mmc1 */
+	P9_92_pinmux {
+		status = "disabled";
+	};
+};
+
 &mmc1 {
 	vmmc-supply = <&ldo3_reg>;
 };
@@ -61,12 +68,16 @@
 /* #include "am335x-bone-spi1a-spidev.dtsi" */
 
 /* uart1: P9.24, P9.26 */
+#include "am335x-ttyO1.dtsi"
 /* #include "am335x-bone-ttyO1.dtsi" */
 /* uart2: P9.21, P9.22 */
+#include "am335x-ttyO2.dtsi"
 /* #include "am335x-bone-ttyO2.dtsi" */
 /* uart4: P9.11, P9.13 */
+#include "am335x-ttyO4.dtsi"
 /* #include "am335x-bone-ttyO4.dtsi" */
 /* uart5: P8.37, P8.38 */
+#include "am335x-ttyO5.dtsi"
 /* #include "am335x-bone-ttyO5.dtsi" */
 
 /* Capes */
diff --git a/arch/arm/boot/dts/am335x-boneblack-nxp-hdmi-audio.dtsi b/arch/arm/boot/dts/am335x-boneblack-nxp-hdmi-audio.dtsi
index 64cfc22..6466560 100644
--- a/arch/arm/boot/dts/am335x-boneblack-nxp-hdmi-audio.dtsi
+++ b/arch/arm/boot/dts/am335x-boneblack-nxp-hdmi-audio.dtsi
@@ -7,6 +7,13 @@
  */
 
 &ocp {
+	/* hdmi */
+	P8_37_pinmux {
+		status = "disabled";
+	};
+	P8_38_pinmux {
+		status = "disabled";
+	};
 	/* audio */
 	P9_25_pinmux {
 		status = "disabled";
diff --git a/arch/arm/boot/dts/am335x-boneblack.dts b/arch/arm/boot/dts/am335x-boneblack.dts
index 180f7fa..7c67d45 100644
--- a/arch/arm/boot/dts/am335x-boneblack.dts
+++ b/arch/arm/boot/dts/am335x-boneblack.dts
@@ -75,12 +75,16 @@
 /* #include "am335x-bone-spi1a-spidev.dtsi" */
 
 /* uart1: P9.24, P9.26 */
+#include "am335x-ttyO1.dtsi"
 /* #include "am335x-bone-ttyO1.dtsi" */
 /* uart2: P9.21, P9.22 */
+#include "am335x-ttyO2.dtsi"
 /* #include "am335x-bone-ttyO2.dtsi" */
 /* uart4: P9.11, P9.13 */
+#include "am335x-ttyO4.dtsi"
 /* #include "am335x-bone-ttyO4.dtsi" */
 /* uart5: P8.37, P8.38 boneblack: hdmi has to be disabled for ttyO5 */
+#include "am335x-ttyO5.dtsi"
 /* #include "am335x-bone-ttyO5.dtsi" */
 
 /* Capes */
diff --git a/arch/arm/boot/dts/am335x-ttyO1.dtsi b/arch/arm/boot/dts/am335x-ttyO1.dtsi
new file mode 100644
index 0000000..039763a
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-ttyO1.dtsi
@@ -0,0 +1,14 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+&uart1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <>;
+
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/am335x-ttyO2.dtsi b/arch/arm/boot/dts/am335x-ttyO2.dtsi
new file mode 100644
index 0000000..a7c3117
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-ttyO2.dtsi
@@ -0,0 +1,14 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+&uart2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <>;
+
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/am335x-ttyO4.dtsi b/arch/arm/boot/dts/am335x-ttyO4.dtsi
new file mode 100644
index 0000000..76fb6a2
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-ttyO4.dtsi
@@ -0,0 +1,14 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+&uart4 {
+	pinctrl-names = "default";
+	pinctrl-0 = <>;
+
+	status = "okay";
+};
diff --git a/arch/arm/boot/dts/am335x-ttyO5.dtsi b/arch/arm/boot/dts/am335x-ttyO5.dtsi
new file mode 100644
index 0000000..5675eeb
--- /dev/null
+++ b/arch/arm/boot/dts/am335x-ttyO5.dtsi
@@ -0,0 +1,14 @@
+/*
+ * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+&uart5 {
+	pinctrl-names = "default";
+	pinctrl-0 = <>;
+
+	status = "okay";
+};
-- 
2.1.0

