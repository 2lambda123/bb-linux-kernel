From c4aa665255d2d952e5a8763824c2f382401c2d7f Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Tue, 27 Sep 2016 15:03:19 -0500
Subject: [PATCH 4/4] bbbw: control wl18xx_bt_en, via led subsystem, instead of
 hog

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi | 31 ++++++++++++++------------
 1 file changed, 17 insertions(+), 14 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi b/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi
index 9494501..8ad342a 100644
--- a/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi
+++ b/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi
@@ -2,6 +2,18 @@
 #include <dt-bindings/interrupt-controller/irq.h>
 
 / {
+	leds {
+		pinctrl-names = "default";
+		pinctrl-0 = <&wl18xx_pins>;
+		compatible = "gpio-leds";
+
+		wl18xx_bt_en {
+			label = "wl18xx_bt_en";
+			gpios = <&gpio0 28 GPIO_ACTIVE_HIGH>;
+			default-state = "off";
+		};
+	};
+
 	tibt {
 		compatible = "tibt";
 		nshutdown_gpio = <28>;
@@ -16,15 +28,15 @@
 };
 
 &am33xx_pinmux {
-	wlbtbuf_pin: pinmux_wlbtbuf_pin {
+	wl18xx_pins: pinmux_wl18xx_pins {
 		pinctrl-single,pins = <
-			0x130 ( PIN_OUTPUT_PULLUP | MUX_MODE7 ) /* (L18) gmii1_rxclk.gpio3[10] - LS_BUF_EN */
+			0x128 (PIN_OUTPUT_PULLUP | MUX_MODE7)	/* (K17) gmii1_txd0.gpio0[28] - BT_EN */
 		>;
 	};
 
-	bt_pins: pinmux_bt_pins {
+	wlbtbuf_pin: pinmux_wlbtbuf_pin {
 		pinctrl-single,pins = <
-			0x128 (PIN_OUTPUT_PULLUP | MUX_MODE7)	/* (K17) gmii1_txd0.gpio0[28] - BT_EN */
+			0x130 ( PIN_OUTPUT_PULLUP | MUX_MODE7 ) /* (L18) gmii1_rxclk.gpio3[10] - LS_BUF_EN */
 		>;
 	};
 
@@ -83,15 +95,6 @@
 	};
 };
 
-&gpio0 {
-	bt_en {
-		output;
-		gpios = <28 0>;
-		dir-changeable;
-		line-name = "BT_EN";
-	};
-};
-
 &gpio3 {
 	wl_en {
 		gpio-hog;
@@ -110,6 +113,6 @@
 
 &uart3 {
 	pinctrl-names = "default";
-	pinctrl-0 = <&uart3_pins_default &bt_pins>;
+	pinctrl-0 = <&uart3_pins_default>;
 	status = "okay";
 };
-- 
2.9.3

