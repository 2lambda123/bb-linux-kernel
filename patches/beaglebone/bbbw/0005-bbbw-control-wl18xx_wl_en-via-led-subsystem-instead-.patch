From a6d467b89cd85425542db21c4d4cc6fe3b5717ec Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Tue, 27 Sep 2016 15:04:33 -0500
Subject: [PATCH 5/5] bbbw: control wl18xx_wl_en, via led subsystem, instead of
 hog

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi | 15 +++++++--------
 1 file changed, 7 insertions(+), 8 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi b/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi
index 8ad342a..82da276 100644
--- a/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi
+++ b/arch/arm/boot/dts/am335x-boneblack-wl1835.dtsi
@@ -7,6 +7,12 @@
 		pinctrl-0 = <&wl18xx_pins>;
 		compatible = "gpio-leds";
 
+		wl18xx_wl_en {
+			label = "wl18xx_wl_en";
+			gpios = <&gpio3 9 GPIO_ACTIVE_HIGH>;
+			default-state = "on";
+		};
+
 		wl18xx_bt_en {
 			label = "wl18xx_bt_en";
 			gpios = <&gpio0 28 GPIO_ACTIVE_HIGH>;
@@ -31,6 +37,7 @@
 	wl18xx_pins: pinmux_wl18xx_pins {
 		pinctrl-single,pins = <
 			0x128 (PIN_OUTPUT_PULLUP | MUX_MODE7)	/* (K17) gmii1_txd0.gpio0[28] - BT_EN */
+			0x12c (PIN_OUTPUT_PULLDOWN | MUX_MODE7 ) /* (K18) gmii1_txclk.gpio3[9] - WL_EN */
 		>;
 	};
 
@@ -54,7 +61,6 @@
 	/* wl18xx card enable/irq GPIOs. */
 	wlan_pins: pinmux_wlan_pins {
 		pinctrl-single,pins = <
-			0x12c ( PIN_OUTPUT_PULLDOWN | MUX_MODE7 ) /* (K18) gmii1_txclk.gpio3[9] - WL_EN */
 			0x144 ( PIN_INPUT_PULLUP | MUX_MODE7 )  /* (H18) rmii1_refclk.gpio0[29] - WL_IRQ */
 		>;
 	};
@@ -96,13 +102,6 @@
 };
 
 &gpio3 {
-	wl_en {
-		gpio-hog;
-		gpios = <9 GPIO_ACTIVE_HIGH>;
-		output-high;
-		line-name = "WL_EN";
-	};
-
 	ls_buf_en {
 		gpio-hog;
 		gpios = <10 GPIO_ACTIVE_HIGH>;
-- 
2.9.3

